<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>حساب البونيكام — مرتّب</title>
  <meta name="theme-color" content="#ffcc00">
  <style>
    :root{--brand:#FFCC00;--ink:#111;--muted:#666;--bg:#fafafa;--card:#fff;--border:#e6e6e6;--ok:#1a7f37;--no:#c9352b}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,Arial;background:var(--bg);color:var(--ink);margin:0;padding:24px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:44px;height:44px;border-radius:12px;background:var(--brand);display:grid;place-items:center;font-weight:800;font-size:24px;color:#003}
    h1{margin:0;font-size:22px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
    .grid{display:grid;gap:12px}
    .inputs{grid-template-columns:repeat(2,minmax(120px,1fr)) repeat(2,minmax(120px,1fr));align-items:end}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="date"],input[type="number"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:16px}
    .checks{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
    .check{display:flex;gap:8px;align-items:center;font-size:14px}
    .check input{width:18px;height:18px}
    button.primary{background:var(--ink);color:#fff;border:0;padding:12px 16px;border-radius:10px;font-size:16px;cursor:pointer}
    button.primary:hover{opacity:.9}
    table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    thead th{background:#fff8cc;color:#222;font-weight:700;padding:10px;font-size:14px;border-bottom:1px solid var(--border)}
    tbody td{padding:10px;border-bottom:1px solid var(--border);font-size:14px;vertical-align:middle}
    tfoot td{padding:12px;font-weight:700;background:#f6f6f6}
    td.num{text-align:left;font-variant-numeric:tabular-nums}
    .pill{padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px;display:inline-block}
    .pill.ok{background:#e6f4ea;color:var(--ok)}
    .pill.no{background:#fdecea;color:var(--no)}
    .editable{background:#fff;border:1px dashed #ddd;border-radius:8px;padding:6px 8px;min-width:72px}
    .del{background:#fff;color:#b00020;border:1px solid #ffd6d6;padding:6px 10px;border-radius:8px;cursor:pointer}
    .hint{color:var(--muted);font-size:12px}
    .totals{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    .kpi{background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px}
    .kpi .t{color:var(--muted);font-size:12px}
    .kpi .v{font-weight:800;font-size:18px}
    @media (max-width:900px){.inputs{grid-template-columns:1fr 1fr}.totals{grid-template-columns:1fr 1fr}thead th:nth-last-child(2){display:none}}
  </style>
</head>
<body>
  <header>
    <div class="logo">ب</div>
    <div>
      <h1>حساب البونيكام</h1>
      <div class="hint">إدخال سريع + متابعة دفع <b>الحراج</b> و<b>عمولة العامل</b> — يحفظ تلقائيًا.</div>
    </div>
  </header>

  <section class="card grid inputs">
    <div>
      <label>التاريخ</label>
      <input id="date" type="date">
    </div>
    <div>
      <label>عدد الفلين</label>
      <input id="qty" type="number" inputmode="numeric" placeholder="مثال: 25">
    </div>
    <div>
      <label>سعر الفلين (ريال)</label>
      <input id="price" type="number" inputmode="numeric" step="0.01" placeholder="مثال: 25">
    </div>
    <div class="checks">
      <label style="width:100%">خيارات</label>
      <label class="check"><input id="harajPaid" type="checkbox"> تم دفع الحراج (١٪)</label>
      <label class="check"><input id="workerPaid" type="checkbox"> تم دفع عمولة العامل (٢ ريال/فلين)</label>
      <button class="primary" id="add">+ إضافة</button>
    </div>
  </section>

  <section class="card">
    <table id="table">
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>عدد الفلين</th>
          <th>سعر/فلين</th>
          <th>الإجمالي</th>
          <th>نسبة الحراج ١٪</th>
          <th>أجر العامل (٢/فلين)</th>
          <th>تم دفع الحراج؟</th>
          <th>دُفعت العمولة؟</th>
          <th>صافي الربح</th>
          <th>حذف</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="10">
            <div class="totals">
              <div class="kpi"><div class="t">مجموع المبيعات</div><div class="v"><span id="t-sum">0</span> ر.س</div></div>
              <div class="kpi"><div class="t">إجمالي الحراج</div><div class="v"><span id="t-haraj">0</span> ر.س</div></div>
              <div class="kpi"><div class="t">إجمالي أجور العامل</div><div class="v"><span id="t-worker">0</span> ر.س</div></div>
              <div class="kpi"><div class="t">صافي الربح</div><div class="v"><span id="t-net">0</span> ر.س</div></div>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
    <div class="hint" style="margin-top:8px">اضغط على <b>عدد الفلين</b> أو <b>السعر</b> للتعديل المباشر في أي سطر.</div>
  </section>

<script>
  const LS_KEY = 'bonkaim_v2';
  const workerFeePerCrate = 2;
  const harajRate = 0.01;

  const el = id => document.getElementById(id);
  const fmt = v => (Math.round(v * 100) / 100).toLocaleString('ar-SA', {minimumFractionDigits:2, maximumFractionDigits:2});

  const state = { rows: [] };

  function load(){
    try{
      const saved = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      if(saved.rows && Array.isArray(saved.rows)) state.rows = saved.rows;
    }catch(e){}
  }
  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

  function addRow(r){ state.rows.push(r); save(); render(); }
  function delRow(i){ state.rows.splice(i,1); save(); render(); }

  function updateTotals(){
    const sum = state.rows.reduce((a,r)=>a+(r.qty*r.price),0);
    const haraj = state.rows.reduce((a,r)=>a+(r.qty*r.price*harajRate),0);
    const worker = state.rows.reduce((a,r)=>a+(r.qty*workerFeePerCrate),0);
    const net = sum - haraj - worker;
    el('t-sum').textContent = fmt(sum);
    el('t-haraj').textContent = fmt(haraj);
    el('t-worker').textContent = fmt(worker);
    el('t-net').textContent = fmt(net);
  }

  function render(){
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML='';
    state.rows.forEach((r,i)=>{
      const gross = r.qty*r.price;
      const haraj = gross*harajRate;
      const worker = r.qty*workerFeePerCrate;
      const net = gross - haraj - worker;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.date||''}</td>
        <td class="num"><input class="editable" type="number" step="1" value="${r.qty}" data-idx="${i}" data-field="qty"></td>
        <td class="num"><input class="editable" type="number" step="0.01" value="${r.price}" data-idx="${i}" data-field="price"></td>
        <td class="num">${fmt(gross)}</td>
        <td class="num">${fmt(haraj)}</td>
        <td class="num">${fmt(worker)}</td>
        <td><label class="check"><input type="checkbox" ${r.harajPaid?'checked':''} data-idx="${i}" data-flag="harajPaid"><span class="pill ${r.harajPaid?'ok':'no'}">${r.harajPaid?'مدفوع':'غير مدفوع'}</span></label></td>
        <td><label class="check"><input type="checkbox" ${r.workerPaid?'checked':''} data-idx="${i}" data-flag="workerPaid"><span class="pill ${r.workerPaid?'ok':'no'}">${r.workerPaid?'مدفوع':'غير مدفوع'}</span></label></td>
        <td class="num">${fmt(net)}</td>
        <td><button class="del" data-del="${i}">حذف</button></td>
      `;
      tbody.appendChild(tr);
    });

    tbody.querySelectorAll('input.editable').forEach(inp=>{
      inp.addEventListener('change', e=>{
        const i = +e.target.dataset.idx;
        const f = e.target.dataset.field;
        let v = +e.target.value;
        if(!Number.isFinite(v)||v<0) v = 0;
        state.rows[i][f] = v;
        save(); render();
      });
    });
    tbody.querySelectorAll('input[type="checkbox"][data-flag]').forEach(ch=>{
      ch.addEventListener('change', e=>{
        const i = +e.target.dataset.idx;
        const flag = e.target.dataset.flag;
        state.rows[i][flag] = e.target.checked;
        save(); render();
      });
    });
    tbody.querySelectorAll('button.del').forEach(btn=>{
      btn.addEventListener('click', e=> delRow(+e.target.dataset.del));
    });

    updateTotals();
  }

  function todayISO(){
    const d=new Date(); const m=('0'+(d.getMonth()+1)).slice(-2); const day=('0'+d.getDate()).slice(-2);
    return `${d.getFullYear()}-${m}-${day}`;
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('date').value = todayISO();
    load(); render();
    document.getElementById('add').addEventListener('click', ()=>{
      const r = {
        date: document.getElementById('date').value,
        qty: +document.getElementById('qty').value || 0,
        price: +document.getElementById('price').value || 0,
        harajPaid: document.getElementById('harajPaid').checked,
        workerPaid: document.getElementById('workerPaid').checked
      };
      if(!r.qty || !r.price){ alert('عبي عدد الفلين والسعر.'); return; }
      addRow(r);
      document.getElementById('qty').value='';
      document.getElementById('price').value='';
      document.getElementById('harajPaid').checked=false;
      document.getElementById('workerPaid').checked=false;
    });
  });
</script>
</body>
</html>